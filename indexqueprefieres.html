<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>¿Qué prefieres?</title>
  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2b;
      --text: #e9ecff;
      --muted: #96a0c8;
      --a: #3fa7ff;
      --b: #ff5a76;
      --ok: #35d399;
      --warn: #ffd166;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 80% -10%, #1d2140 0%, var(--bg) 60%);
      color: var(--text);
      display: grid; place-items: center;
    }
    .app { width: min(980px, 96vw); padding: 24px; }

    header { display: flex; gap: 12px; align-items: center; justify-content: space-between; margin-bottom: 18px; }
    .brand { display: flex; gap: 10px; align-items: center; }
    .logo { width: 38px; height: 38px; border-radius: 12px; background: linear-gradient(135deg, var(--a), var(--b)); box-shadow: 0 8px 24px rgba(0,0,0,.35); }
    .brand h1 { font-size: 20px; margin: 0; letter-spacing: .2px; }

    nav { display: flex; gap: 8px; flex-wrap: wrap; }
    button, .btn { cursor: pointer; border: 0; padding: 10px 14px; border-radius: 12px; background: #232845; color: var(--text); font-weight: 600; box-shadow: 0 6px 18px rgba(0,0,0,.15); }
    button:hover, .btn:hover { filter: brightness(1.05); }
    .primary { background: linear-gradient(135deg, var(--a), #6ad1ff); color: #07111f; }
    .danger { background: linear-gradient(135deg, #ff6b6b, #ff8fa3); color: #230b0b; }

    .card { background: var(--card); border: 1px solid #23284a; border-radius: 18px; padding: 18px; box-shadow: 0 12px 40px rgba(0,0,0,.25); }

    .center { text-align: center; }
    .muted { color: var(--muted); font-size: 14px; }

    .question-text { font-size: clamp(22px, 4vw, 36px); font-weight: 800; line-height: 1.15; margin: 4px 0 18px; text-wrap: balance; }

    .options { display: grid; gap: 12px; grid-template-columns: 1fr; }
    @media (min-width: 700px) { .options { grid-template-columns: 1fr 1fr; } }

    .option {
      border-radius: 16px; padding: 0; min-height: 110px; display: grid; grid-template-rows: auto auto; align-items: stretch; text-align: center; font-size: 18px; font-weight: 700;
      border: 1px solid rgba(255,255,255,.06);
      transition: transform .08s ease, box-shadow .15s ease;
      user-select: none; overflow: hidden;
    }
    .option:hover { transform: translateY(-1px); box-shadow: 0 10px 24px rgba(0,0,0,.25); }
    .option.a { background: linear-gradient(135deg, rgba(63,167,255,.15), rgba(63,167,255,.07)); }
    .option.b { background: linear-gradient(135deg, rgba(255,90,118,.15), rgba(255,90,118,.07)); }

    .opt-media { aspect-ratio: 16/9; width: 100%; background: #0d1022; display: grid; place-items: center; overflow: hidden; }
    .opt-media img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .opt-caption { padding: 14px; }

    .row { display: grid; gap: 12px; grid-template-columns: 1fr; }
    @media (min-width: 680px) { .row.two { grid-template-columns: 1fr 1fr; } }

    input[type="text"], textarea, input[type="url"] {
      width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid #2b315c; background: #11152b; color: var(--text); font-size: 16px;
    }
    label { font-size: 14px; color: var(--muted); margin-bottom: 6px; display: inline-block; }

    .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    .bar { height: 14px; background: #0d1022; border-radius: 10px; overflow: hidden; border: 1px solid #242a52; }
    .fill { height: 100%; }
    .fill.a { background: var(--a); }
    .fill.b { background: var(--b); }

    .stack { display: grid; gap: 14px; }
    .hidden { display: none !important; }
    .right { text-align: right; }
    .pill { padding: 6px 10px; border-radius: 999px; background: #232845; color: var(--muted); font-size: 12px; display: inline-flex; gap: 6px; align-items: center; }

    .thumbs { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .thumbs .thumb { aspect-ratio: 16/9; background:#0d1022; border:1px solid #242a52; border-radius: 10px; overflow:hidden; display:grid; place-items:center; }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }

    footer { margin-top: 16px; text-align: center; color: var(--muted); font-size: 12px; }
  </style>
</head>
<body>

  <script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";


// Verificar si hay usuario logueado
const { data, error } = await sb.auth.getUser();

if (error || !data.user) {
  window.location.href = "index.html"; // Redirige si no hay sesión
}
</script>

  <div class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>¿Qué prefieres?</h1>
      </div>
    <nav>
      <button id="navPlay">Jugar</button>
      <button id="navCreate">Crear</button>
      <button id="navFeed">Explorar</button>

      <div class="auth">
        <span id="authUser" class="meta">Invitado</span>
        <button id="btnSignIn" class="primary">Iniciar sesión</button>
        <button id="btnSignOut" class="hidden">Salir</button>
      </div>
    </nav>

    </header>

    <!-- HOME / PLAY -->
    <section id="viewPlay" class="card center">
      <p class="muted">Pregunta creada por <span id="qAuthor">—</span></p>
      <h2 id="qText" class="question-text">Cargando…</h2>
      <div class="options">
        <div id="optA" role="button" tabindex="0" class="option a">
          <div class="opt-media" id="mediaA"></div>
          <div class="opt-caption" id="captionA">Opción A</div>
        </div>
        <div id="optB" role="button" tabindex="0" class="option b">
          <div class="opt-media" id="mediaB"></div>
          <div class="opt-caption" id="captionB">Opción B</div>
        </div>
      </div>
      <div id="result" class="stack hidden">
        <div class="row two">
          <div class="pill">A: <strong id="pctA">0%</strong></div>
          <div class="pill right">B: <strong id="pctB">0%</strong></div>
        </div>
        <div class="stats">
          <div class="bar"><div id="fillA" class="fill a" style="width:0%"></div></div>
          <div class="bar"><div id="fillB" class="fill b" style="width:0%"></div></div>
        </div>
        <div class="row two">
          <button id="next" class="btn">Siguiente pregunta ▶</button>
          <button id="share" class="btn">Compartir</button>
        </div>
      </div>
    </section>

    <!-- CREATE -->
    <section id="viewCreate" class="card stack hidden">
      <h3 class="center" style="margin:0">Crear un “¿Qué prefieres?”</h3>
      <p class="muted center">El texto queda centrado; puedes añadir imágenes a cada opción (URL o archivo).</p>
      <div class="stack">
        <div>
          <label for="inpQ">Pregunta</label>
          <textarea id="inpQ" rows="3" placeholder="¿Qué prefieres…?"></textarea>
        </div>
        <div class="row two">
          <div class="stack">
            <label>Opción A</label>
            <input id="inpA" type="text" placeholder="Texto de la opción A" />
            <input id="urlA" type="url" placeholder="URL de imagen (opcional)" />
            <input id="fileA" type="file" accept="image/*" />
            <div class="thumbs"><div class="thumb"><img id="prevA" alt=""/></div></div>
          </div>
          <div class="stack">
            <label>Opción B</label>
            <input id="inpB" type="text" placeholder="Texto de la opción B" />
            <input id="urlB" type="url" placeholder="URL de imagen (opcional)" />
            <input id="fileB" type="file" accept="image/*" />
            <div class="thumbs"><div class="thumb"><img id="prevB" alt=""/></div></div>
          </div>
        </div>
        <div class="row two">
          <button id="saveQ" class="primary">Publicar</button>
          <button id="clearForm">Limpiar</button>
        </div>
      </div>
    </section>

    <!-- FEED -->
    <section id="viewFeed" class="card stack hidden">
      <h3 style="margin:0">Explorar preguntas</h3>
      <div id="feedList" class="stack"></div>
    </section>

    <!-- LOGIN -->
    <section id="viewLogin" class="card stack hidden">
      <h3 style="margin:0" class="center">Tu usuario</h3>
      <p class="muted center">Por ahora es local (nickname). En la versión online será con email/Google.</p>
      <div class="row two">
        <div>
          <label for="nick">Nickname</label>
          <input id="nick" type="text" placeholder="Ej: PanitaXD" />
        </div>
        <div class="stack">
          <label>&nbsp;</label>
          <button id="setNick" class="primary">Guardar</button>
          <button id="logout" class="danger">Borrar usuario local</button>
        </div>
      </div>
      <p class="muted">Estado: <span id="authState">—</span></p>
    </section>

    <footer>
      Hecho con ❤️ para prototipo. Votos, usuario e imágenes (base64/URL) guardados en <strong>localStorage</strong>.
    </footer>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    /*********************************
     * PEQUEÑA "BASE DE DATOS" LOCAL *
     *********************************/
    const DB_KEY = 'qp_db_v2_images';
    const USER_KEY = 'qp_user_v1';

    // ====== CONFIGURACIÓN SUPABASE ======
    const SUPABASE_URL = "https://jrzpqsgjghopnnntxypp.supabase.co"; // tu URL real
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyenBxc2dqZ2hvcG5ubnR4eXBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5ODcsImV4cCI6MjA3NDgyMzk4N30.Wv-4VQOYtgH5q_X8AsnwJSXqvgWfiGul7hki08KoemU";

    // Crear el cliente global de Supabase
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // ====== AUTENTICACIÓN (SUPABASE) ======
    const AUTH_REDIRECT = window.location.origin;
    let CURRENT_USER = null;

    function setAuthUI(user) {
      const elUser = document.getElementById("authUser");
      const btnIn = document.getElementById("btnSignIn");
      const btnOut = document.getElementById("btnSignOut");

      if (user) {
        elUser.textContent = user.email || "Usuario";
        btnIn.classList.add("hidden");
        btnOut.classList.remove("hidden");
      } else {
        elUser.textContent = "Invitado";
        btnIn.classList.remove("hidden");
        btnOut.classList.add("hidden");
      }
    }

    // ✅ Sincronizar nickname local con Supabase
async function syncUserNickname() {
  const { data } = await sb.auth.getSession();
  const user = data?.session?.user;

  if (!user) return;

  let localUser = getUser();

  if (!localUser) {
    // Buscar si ya hay nickname
    let nickname = localStorage.getItem("nickname");

    // Si no hay nickname guardado, pedimos uno
    if (!nickname) {
      nickname = prompt("Ingresa tu nickname (solo la primera vez):");
      if (nickname) {
        localStorage.setItem("nickname", nickname.trim());
      } else {
        alert("Debes tener un nickname para continuar.");
        return;
      }
    }

    // Guardar también en tu sistema local
    setUser(nickname.trim());
  }
}

  sb.auth.getSession().then(({ data }) => {
    CURRENT_USER = data?.session?.user || null;
    setAuthUI(CURRENT_USER);
  });

  sb.auth.onAuthStateChange((_event, session) => {
    CURRENT_USER = session?.user || null;
    setAuthUI(CURRENT_USER);
  });



    function loadDB() {
      const raw = localStorage.getItem(DB_KEY);
      if (raw) try { return JSON.parse(raw); } catch {}
      // semilla inicial
      const seed = [
        mkQ('¿Qué prefieres?', 'Dormir 5 min más', 'Despertar sin sueño', 'sistema', null, null),
        mkQ('¿Qué prefieres?', 'Comer pizza por un año', 'Comer sushi por un año', 'sistema', null, null),
        mkQ('¿Qué prefieres?', 'Tu novio salga con su ex a café', 'Que pierda una pierna 😬', 'anon', null, null),
        mkQ('¿Qué prefieres?', 'Tal chica de anime', 'Tal otra chica de anime', 'anon', null, null)
      ];
      saveDB(seed);
      return seed;
    }
    function saveDB(arr){ localStorage.setItem(DB_KEY, JSON.stringify(arr)); }

    function mkQ(q, a, b, author, aImg, bImg) {
      return { id: crypto.randomUUID(), q, a, b, aImg: aImg||null, bImg: bImg||null, author, votesA: 0, votesB: 0, voters: {} };
    }

 function setUser(nick) {
  const nickTrim = nick.trim();
  localStorage.setItem(USER_KEY, JSON.stringify({ id: 'local:' + nickTrim.toLowerCase(), nick: nickTrim }));
  localStorage.setItem("nickname", nickTrim); // redundancia por si acaso
}

function getUser() {
  // Prioridad 1: datos locales
  const raw = localStorage.getItem(USER_KEY);
  if (raw) {
    try { return JSON.parse(raw); } catch {}
  }

  // Prioridad 2: nickname directo
  const nick = localStorage.getItem("nickname");
  if (nick) return { id: 'local:' + nick.toLowerCase(), nick };

  // Prioridad 3: usuario Supabase (solo correo)
  const session = window._lastSupabaseSession; // guardaremos aquí la sesión más reciente
  const email = session?.user?.email;
  if (email) return { id: 'supabase:' + email.toLowerCase(), nick: email };

  return null;
}
// 🧠 Asegurar que el nickname se guarde si el usuario está autenticado en Supabase
(async () => {
  const { data } = await sb.auth.getSession();
  const user = data?.session?.user;
  if (user) {
    window._lastSupabaseSession = data.session;
    let nickname = localStorage.getItem("nickname");
    if (!nickname) {
      nickname = prompt("Ingresa tu nickname (solo la primera vez):");
      if (nickname) {
        localStorage.setItem("nickname", nickname.trim());
        setUser(nickname.trim());
      }
    }
  }
})();


function delUser() {
  localStorage.removeItem(USER_KEY);
  localStorage.removeItem("nickname");
}


    let DB = loadDB();

    /********************
     * UI & NAVEGACIÓN  *
     ********************/
    const $ = (sel) => document.querySelector(sel);
    const views = {
      play: $('#viewPlay'),
      create: $('#viewCreate'),
      feed: $('#viewFeed'),
      login: $('#viewLogin'),
    };

    function show(which){
      Object.values(views).forEach(v => v.classList.add('hidden'));
      views[which].classList.remove('hidden');
      if (which === 'play') loadRandom();
      if (which === 'feed') renderFeed();
      updateNav();
    }

    $('#navPlay').onclick = () => show('play');
    $('#navCreate').onclick = () => show('create');
    $('#navFeed').onclick = () => show('feed');
 
    

    // LOGIN
    $('#setNick').onclick = () => {
      const nick = $('#nick').value.trim();
      if (!nick) return alert('Escribe un nickname');
      setUser(nick); updateNav(); alert('✓ Usuario guardado');
    };
    $('#logout').onclick = () => { delUser(); updateNav(); alert('Sesión local eliminada'); };

    // HELPERS
    function readFileToDataUrl(file){
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    async function resolveImage(urlInput, fileInput){
      const url = urlInput.value.trim();
      if (url) return url; // usar URL directa
      const file = fileInput.files?.[0];
      if (file) {
        // Nota: se guarda como base64 en localStorage (solo prototipo)
        try { return await readFileToDataUrl(file); } catch { return null; }
      }
      return null;
    }

    // CREATE
    const fileA = $('#fileA');
    const fileB = $('#fileB');
    const urlA  = $('#urlA');
    const urlB  = $('#urlB');
    const prevA = $('#prevA');
    const prevB = $('#prevB');

    fileA?.addEventListener('change', async () => { const f = fileA.files?.[0]; prevA.src = f ? await readFileToDataUrl(f) : ''; });
    fileB?.addEventListener('change', async () => { const f = fileB.files?.[0]; prevB.src = f ? await readFileToDataUrl(f) : ''; });
    urlA?.addEventListener('change', () => { prevA.src = urlA.value || ''; });
    urlB?.addEventListener('change', () => { prevB.src = urlB.value || ''; });

 $('#saveQ').onclick = async () => {
  const u = getUser();
  if (!u) return alert('Primero inicia sesión (nickname).');

  const q = $('#inpQ').value.trim();
  const a = $('#inpA').value.trim();
  const b = $('#inpB').value.trim();
  const aImg = await resolveImage(urlA, fileA);
  const bImg = await resolveImage(urlB, fileB);

  if (!q || !a || !b) return alert('Completa la pregunta y ambas opciones.');

  const { error } = await sb.from('Peguntas').insert({
    pregunta: q,
    opcion_a: a,
    opcion_b: b,
    imagen_a: aImg,
    imagen_b: bImg,
    autor: u.nick || 'anon'
  });

  if (error) {
    console.error(error);
    alert('⚠️ Error al publicar la pregunta.');
  } else {
    alert('✅ Pregunta publicada en Supabase!');
    $('#inpQ').value = '';
    $('#inpA').value = '';
    $('#inpB').value = '';
    urlA.value = '';
    urlB.value = '';
    if (prevA) prevA.src = '';
    if (prevB) prevB.src = '';
    if (fileA) fileA.value = '';
    if (fileB) fileB.value = '';
    show('play');
  }
};

    // PLAY
    let current = null;
    function setOption(elMedia, elCaption, text, img){
      elCaption.textContent = text || '';
      elMedia.innerHTML = '';
      if (img) {
        const im = new Image();
        im.loading = 'lazy';
        im.decoding = 'async';
        im.alt = text || '';
        im.src = img;
        elMedia.appendChild(im);
      } else {
        elMedia.innerHTML = '<span class="muted">Sin imagen</span>';
      }
    }

async function loadRandom() {
  try {
    const { data, error } = await sb
      .from('preguntas')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;

    if (!data || data.length === 0) {
      $('#qText').textContent = "No hay preguntas aún 😢";
      $('#qAuthor').textContent = "";
      return;
    }

    // Elegir una pregunta aleatoria
    const item = data[Math.floor(Math.random() * data.length)];
    current = item;

    $('#qAuthor').textContent = item.autor || 'Anónimo';
    $('#qText').textContent = item.pregunta;
    setOption($('#mediaA'), $('#captionA'), item.opcion_a, item.imagen_a);
    setOption($('#mediaB'), $('#captionB'), item.opcion_b, item.imagen_b);
    $('#result').classList.add('hidden');
  } catch (err) {
    console.error("Error cargando pregunta:", err);
    $('#qText').textContent = "⚠️ Error cargando preguntas";
  }
}


async function vote(which) {
  const u = getUser();
  if (!u) return alert('Primero inicia sesión (nickname).');
  if (!current) return;

  const field = which === 'A' ? 'votos_a' : 'votos_b';
  const newValue = (current[field] || 0) + 1;

  const { error } = await sb
    .from('preguntas')
    .update({ [field]: newValue })
    .eq('id', current.id);

  if (error) {
    console.error(error);
    alert('⚠️ Error registrando el voto.');
    return;
  }

  current[field] = newValue;
  showResult();
}


    function showResult(){
      const total = (current.votesA + current.votesB) || 1;
      const pctA = Math.round(current.votesA * 100 / total);
      const pctB = 100 - pctA;
      $('#pctA').textContent = pctA + '%';
      $('#pctB').textContent = pctB + '%';
      $('#fillA').style.width = pctA + '%';
      $('#fillB').style.width = pctB + '%';
      $('#result').classList.remove('hidden');
    }

    $('#optA').onclick = () => vote('A');
    $('#optB').onclick = () => vote('B');
    $('#next').onclick = () => loadRandom();

    $('#share').onclick = async () => {
      const text = `¿Qué prefieres? ${current.q}
A) ${current.a}
B) ${current.b}`;
      try {
        await navigator.clipboard.writeText(text);
        alert('Copiado al portapapeles ✅');
      } catch {
        alert('No se pudo copiar.');
      }
    };

    // FEED
async function renderFeed() {
  try {
    const list = $('#feedList');
    list.innerHTML = "<p class='muted'>Cargando preguntas...</p>";

    const { data, error } = await sb
      .from('preguntas')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;

    if (!data || data.length === 0) {
      list.innerHTML = "<p class='muted'>No hay preguntas todavía 😢</p>";
      return;
    }

    list.innerHTML = "";
    data.forEach(item => {
      const total = (item.votos_a + item.votos_b) || 0;
      const pct = total ? Math.round(item.votos_a * 100 / total) : 0;

      const el = document.createElement('div');
      el.className = 'card stack';
      el.innerHTML = `
        <div class="muted">Por <strong>${item.autor || 'Anónimo'}</strong></div>
        <div class="question-text center">${item.pregunta}</div>
        <div class="row two">
          <div class="thumb">${item.imagen_a ? `<img src="${item.imagen_a}" alt="A"/>` : '<span class="muted">Sin imagen</span>'}</div>
          <div class="thumb">${item.imagen_b ? `<img src="${item.imagen_b}" alt="B"/>` : '<span class="muted">Sin imagen</span>'}</div>
        </div>
        <div class="row two">
          <div class="pill">A: ${item.opcion_a}</div>
          <div class="pill right">B: ${item.opcion_b}</div>
        </div>
        <div class="stats">
          <div class="bar"><div class="fill a" style="width:${pct}%"></div></div>
          <div class="bar"><div class="fill b" style="width:${100 - pct}%"></div></div>
        </div>
        <div class="row two">
          <button class="btn" data-id="${item.id}">Jugar esta</button>
          <div class="pill">Votos: ${total}</div>
        </div>
      `;

      el.querySelector('button').onclick = () => {
        current = item;
        $('#qAuthor').textContent = item.autor || 'Anónimo';
        $('#qText').textContent = item.pregunta;
        setOption($('#mediaA'), $('#captionA'), item.opcion_a, item.imagen_a);
        setOption($('#mediaB'), $('#captionB'), item.opcion_b, item.imagen_b);
        show('play');
      };
      list.appendChild(el);
    });
  } catch (err) {
    console.error("Error cargando preguntas:", err);
    $('#feedList').innerHTML = "<p class='muted'>⚠️ Error cargando preguntas.</p>";
  }
}



    // START
    (function init(){
      updateNav();
      show('play');
    })();

    // === LOGIN SYSTEM ===

// Referencias a los botones
const btnSignIn = document.getElementById('btnSignIn');
const btnSignOut = document.getElementById('btnSignOut');
const authUser = document.getElementById('authUser');

// --- FUNCIÓN DE LOGIN ---
btnSignIn.addEventListener('click', async () => {
  const email = prompt("📧 Ingresa tu correo para iniciar sesión:");

  if (!email) return alert("Debes ingresar un correo.");

  const { error } = await sb.auth.signInWithOtp({
    email: email,
    options: {
    emailRedirectTo: "https://luiskq1225-dotcom.github.io/survigames/"

  // vuelve a tu sitio
    }
  });

  if (error) {
    alert("Error al enviar el enlace: " + error.message);
  } else {
    alert("📩 Te enviamos un enlace mágico a tu correo. Revisa tu bandeja!");
  }
});


// --- ACTUALIZAR UI ---
sb.auth.onAuthStateChange(async (_event, session) => {
  const user = session?.user;
  if (user) {
    authUser.textContent = user.email;
    btnSignIn.classList.add('hidden');
    btnSignOut.classList.remove('hidden');

    await syncUserNickname(); // 🧩 sincroniza nickname local
  } else {
    authUser.textContent = 'Invitado';
    btnSignIn.classList.remove('hidden');
    btnSignOut.classList.add('hidden');
  }
});


// Revisar si ya está logueado al cargar la página
(async () => {
  const { data } = await sb.auth.getSession();
  const user = data?.session?.user;

  if (user) {
    // Mostrar email
    authUser.textContent = user.email;
    btnSignIn.classList.add('hidden');
    btnSignOut.classList.remove('hidden');

    // 🧩 Nuevo: obtener o guardar el nickname
    let nickname = localStorage.getItem("nickname");

    // Si no hay nickname guardado, pedí uno o usá el que el usuario haya escrito en login
    if (!nickname) {
      nickname = prompt("Ingresa tu nickname (solo la primera vez):");
      if (nickname) {
        localStorage.setItem("nickname", nickname.trim());
      }
    }

  } else {
    // No hay sesión activa
    btnSignIn.classList.remove('hidden');
    btnSignOut.classList.add('hidden');
  }
})();
// 🧩 Si el usuario viene de "Explorar" y había guardado una pregunta
window.addEventListener('load', () => {
  const last = localStorage.getItem('lastPlayed');
  if (last) {
    try {
      const item = JSON.parse(last);
      current = item;
      $('#qAuthor').textContent = item.author || 'anon';
      $('#qText').textContent = item.q;
      setOption($('#mediaA'), $('#captionA'), item.a, item.aImg);
      setOption($('#mediaB'), $('#captionB'), item.b, item.bImg);
      $('#result').classList.add('hidden');
    } catch {}
    localStorage.removeItem('lastPlayed');
  }
});


 </script>
</body>
</html>





